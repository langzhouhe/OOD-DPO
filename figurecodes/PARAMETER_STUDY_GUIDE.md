# Energy-DPO å‚æ•°ç ”ç©¶æŒ‡å—

æœ¬æŒ‡å—æä¾›äº†ç³»ç»Ÿç ”ç©¶ Energy-DPO ä¸­ beta å’Œ lambda å‚æ•°å½±å“çš„å®Œæ•´æµç¨‹ã€‚

## ğŸ“‹ æ¦‚è¿°

å·²ä¸ºä½ åˆ›å»ºçš„å·¥å…·ï¼š

1. **parameter_study.py** - ä¸»è¦çš„ç½‘æ ¼æœç´¢è„šæœ¬
2. **saturation_analysis.py** - é¥±å’Œä¸æ¢¯åº¦åˆ†æå·¥å…·
3. **ä¿®æ”¹çš„ model.py** - æ”¯æŒå¯é…ç½®çš„ lambda å‚æ•°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œå‚æ•°ç½‘æ ¼æœç´¢

```bash
# å®Œæ•´å‚æ•°ç ”ç©¶ï¼ˆæ¨èç”¨äºæœ€ç»ˆå®éªŒï¼‰
python parameter_study.py \
    --dataset drugood \
    --data_file ./data/raw/lbap_general_ec50_scaffold.json \
    --output_dir ./parameter_study_results \
    --batch_size 16 \
    --device cuda

# å¿«é€Ÿæµ‹è¯•æ¨¡å¼ï¼ˆæ¨èç”¨äºåˆæ­¥éªŒè¯ï¼‰
python parameter_study.py \
    --dataset drugood \
    --data_file ./data/raw/lbap_general_ec50_scaffold.json \
    --output_dir ./quick_test \
    --batch_size 16 \
    --device cuda \
    --quick_mode

# æˆ–è€…è®©è„šæœ¬è‡ªåŠ¨æ£€æµ‹æ•°æ®è·¯å¾„ï¼ˆä½¿ç”¨é»˜è®¤æ•°æ®é›†ï¼‰
python parameter_study.py \
    --dataset drugood \
    --drugood_subset lbap_general_ec50_scaffold \
    --output_dir ./parameter_study_results \
    --batch_size 16 \
    --device cuda \
    --quick_mode
```

### 2. è¿è¡Œé¥±å’Œç°è±¡åˆ†æ

```bash
# ç†è®ºåˆ†æï¼ˆä¸éœ€è¦æ•°æ®ï¼Œçº¯æ•°å­¦åˆ†æï¼‰
python saturation_analysis.py --output_dir ./saturation_analysis
```

## ğŸ“Š å‚æ•°ç½‘æ ¼è®¾è®¡

### Beta (DPO å¼ºåº¦) æµ‹è¯•èŒƒå›´
- **[0.01, 0.05]**: æµ‹è¯•æ¢¯åº¦å¼±åŒ–ç°è±¡
- **[0.1, 0.5]**: æ­£å¸¸å·¥ä½œèŒƒå›´
- **[1.0, 2.0, 5.0]**: æµ‹è¯•é¥±å’Œç°è±¡

### Lambda (L2 æ­£åˆ™åŒ–) æµ‹è¯•èŒƒå›´
- **[0.001, 0.005]**: å¼±æ­£åˆ™åŒ–
- **[0.01, 0.05, 0.1]**: å¹³è¡¡èŒƒå›´
- **[0.2, 0.5]**: å¼ºæ­£åˆ™åŒ–

## ğŸ“ˆ é¢„æœŸç»“æœåˆ†æ

è¿è¡Œå®Œæˆåï¼Œä½ å°†è·å¾—ï¼š

### 1. çƒ­åŠ›å›¾åˆ†æ
- `final_eval_loss_heatmap.png` - æœ€ç»ˆæŸå¤±å¯¹æ¯”
- `energy_separation_heatmap.png` - èƒ½é‡åˆ†ç¦»æ•ˆæœ
- `final_gradient_norm_heatmap.png` - æ¢¯åº¦èŒƒæ•°åˆ†å¸ƒ
- `convergence_rate_heatmap.png` - æ”¶æ•›é€Ÿåº¦åˆ†æ
- `training_stability_heatmap.png` - è®­ç»ƒç¨³å®šæ€§

### 2. è®­ç»ƒåŠ¨æ€åˆ†æ
- `training_curves_comparison.png` - å…³é”®å‚æ•°ç»„åˆçš„è®­ç»ƒæ›²çº¿
- `gradient_analysis.png` - æ¢¯åº¦è¡Œä¸ºåˆ†æ
- `parameter_sensitivity.png` - å‚æ•°æ•æ„Ÿæ€§åˆ†æ

### 3. ç†è®ºåˆ†æ
- `dpo_mathematical_analysis.png` - DPO æŸå¤±å‡½æ•°æ•°å­¦ç‰¹æ€§
- `gradient_flow_analysis.png` - æ¢¯åº¦æµåŠ¨æ¨¡å¼
- `parameter_guidance_chart.png` - å‚æ•°é€‰æ‹©æŒ‡å¯¼

### 4. æ•°æ®æ–‡ä»¶
- `parameter_study_results.csv` - æ‰€æœ‰å®éªŒç»“æœ
- `complete_results.json` - å®Œæ•´çš„è®­ç»ƒå†å²
- `summary_report.md` - è‡ªåŠ¨ç”Ÿæˆçš„æ€»ç»“æŠ¥å‘Š

## ğŸ” å…³é”®ç°è±¡è¯†åˆ«

### Beta è¿‡å°å¼•èµ·çš„æ¢¯åº¦å¼±åŒ–
**è¡¨ç°ç‰¹å¾**:
- æ¢¯åº¦èŒƒæ•° < 1e-5
- æŸå¤±ä¸‹é™æç¼“æ…¢
- èƒ½é‡åˆ†ç¦»åº¦æå‡å›°éš¾

**åœ¨ç»“æœä¸­æŸ¥çœ‹**:
- çƒ­åŠ›å›¾ä¸­ beta < 0.05 åŒºåŸŸé¢œè‰²è¾ƒæ·±
- è®­ç»ƒæ›²çº¿å¹³ç¼“æ— æ˜æ˜¾ä¸‹é™
- æ¢¯åº¦åˆ†ææ˜¾ç¤ºæå°çš„æ¢¯åº¦å€¼

### Beta è¿‡å¤§å¼•èµ·çš„é¥±å’Œç°è±¡
**è¡¨ç°ç‰¹å¾**:
- æ¢¯åº¦å¿«é€Ÿè¡°å‡åˆ° 1e-6
- æŸå¤±æå‰å¹³å°åŒ–
- è®­ç»ƒæ›²çº¿å‘ˆç°æ—©æœŸé¥±å’Œ

**åœ¨ç»“æœä¸­æŸ¥çœ‹**:
- çƒ­åŠ›å›¾ä¸­ beta > 2.0 åŒºåŸŸæ€§èƒ½ä¸‹é™
- è®­ç»ƒæ›²çº¿æ—©æœŸå¿«é€Ÿä¸‹é™ååœæ»
- æ¢¯åº¦åˆ†ææ˜¾ç¤ºå¿«é€Ÿè¡°å‡æ¨¡å¼

### Lambda åœ¨ç¨³å®šæ€§ä¸­çš„ä½œç”¨
**L2 æ­£åˆ™åŒ–æ•ˆæœ**:
- Lambda è¿‡å°: è®­ç»ƒä¸ç¨³å®šï¼Œå¯èƒ½æ¢¯åº¦çˆ†ç‚¸
- Lambda è¿‡å¤§: èƒ½é‡è¢«è¿‡åº¦çº¦æŸï¼Œåˆ†ç¦»èƒ½åŠ›å—é™
- Lambda é€‚ä¸­: æä¾›ç¨³å®šçš„è®­ç»ƒè¿‡ç¨‹

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

### 1. å‚æ•°é€‰æ‹©ç­–ç•¥

**åˆæ­¥æ¢ç´¢**:
```bash
# ä½¿ç”¨å¿«é€Ÿæ¨¡å¼å…ˆäº†è§£å¤§è‡´èŒƒå›´
python parameter_study.py --quick_mode
```

**ç²¾ç»†è°ƒä¼˜**:
- æ ¹æ®åˆæ­¥ç»“æœï¼Œç¼©å°å‚æ•°èŒƒå›´
- åœ¨æœ€ä¼˜åŒºåŸŸå‘¨å›´å¢åŠ æ›´å¯†é›†çš„ç½‘æ ¼ç‚¹

### 2. å®éªŒé¡ºåº

1. **ç†è®ºåˆ†æ**: å…ˆè¿è¡Œ `saturation_analysis.py` äº†è§£ç†è®ºåŸºç¡€
2. **å¿«é€Ÿæµ‹è¯•**: ç”¨ `--quick_mode` éªŒè¯å·¥å…·æ­£å¸¸å·¥ä½œ
3. **å®Œæ•´ç ”ç©¶**: è¿è¡Œå®Œæ•´çš„å‚æ•°ç½‘æ ¼æœç´¢
4. **ç»“æœåˆ†æ**: æŸ¥çœ‹ç”Ÿæˆçš„å¯è§†åŒ–å’ŒæŠ¥å‘Š

### 3. ç»“æœè§£è¯»

**æŸ¥çœ‹ä¼˜å…ˆçº§**:
1. `summary_report.md` - å¿«é€Ÿäº†è§£æœ€ä½³å‚æ•°
2. å„ç§çƒ­åŠ›å›¾ - ç†è§£å‚æ•°ç©ºé—´çš„æ•´ä½“è¡¨ç°
3. `training_curves_comparison.png` - æ·±å…¥ç†è§£è®­ç»ƒåŠ¨æ€
4. `parameter_guidance_chart.png` - è·å–é€‰æ‹©æŒ‡å¯¼

## âš ï¸ æ³¨æ„äº‹é¡¹

### è®¡ç®—èµ„æº
- å®Œæ•´ç½‘æ ¼æœç´¢éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆé¢„è®¡ 2-4 å°æ—¶ï¼‰
- å»ºè®®å…ˆç”¨ `--quick_mode` æµ‹è¯•
- å¦‚æœèµ„æºæœ‰é™ï¼Œå¯ä»¥å‡å°‘ beta å’Œ lambda çš„æµ‹è¯•ç‚¹

### æ•°æ®è¦æ±‚
- ç¡®ä¿æ•°æ®è·¯å¾„æ­£ç¡®è®¾ç½®
- å¦‚æœä½¿ç”¨ä¸åŒçš„æ•°æ®é›†ï¼Œéœ€è¦ç›¸åº”è°ƒæ•´ `--dataset` å‚æ•°

### ç»“æœå¯é‡ç°æ€§
- è®¾ç½®ç›¸åŒçš„éšæœºç§å­
- ä½¿ç”¨ç›¸åŒçš„æ•°æ®åˆ†å‰²
- è®°å½•å®éªŒç¯å¢ƒå’Œå‚æ•°è®¾ç½®

## ğŸ”§ è‡ªå®šä¹‰ä¿®æ”¹

### ä¿®æ”¹å‚æ•°èŒƒå›´
åœ¨ `parameter_study.py` ä¸­ä¿®æ”¹ï¼š
```python
self.beta_values = [0.01, 0.05, 0.1, 0.2, 0.5, 1.0, 2.0, 5.0, 10.0]
self.lambda_values = [0.001, 0.005, 0.01, 0.02, 0.05, 0.1, 0.2, 0.5]
```

### æ·»åŠ æ–°çš„è¯„ä¼°æŒ‡æ ‡
åœ¨ `single_experiment` å‡½æ•°ä¸­æ·»åŠ ä½ æ„Ÿå…´è¶£çš„æŒ‡æ ‡ã€‚

### ä¿®æ”¹å¯è§†åŒ–
æ‰€æœ‰ç»˜å›¾å‡½æ•°éƒ½å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ ·å¼å’Œå†…å®¹ã€‚

## ğŸ“ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å†…å­˜ä¸è¶³**: å‡å°‘ `batch_size` æˆ–ä½¿ç”¨ `--quick_mode`
2. **CUDA é”™è¯¯**: è®¾ç½® `--device cpu`
3. **æ•°æ®åŠ è½½å¤±è´¥**: æ£€æŸ¥ `--data_path` è®¾ç½®
4. **å¯¼å…¥é”™è¯¯**: ç¡®ä¿æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…

### ä¾èµ–å®‰è£…
```bash
pip install torch matplotlib seaborn pandas tqdm numpy
```

## ğŸ“š æ·±å…¥é˜…è¯»

ç”Ÿæˆçš„æŠ¥å‘Šä¸­åŒ…å«äº†è¯¦ç»†çš„ç†è®ºåˆ†æå’Œå®è·µå»ºè®®ã€‚ç‰¹åˆ«å…³æ³¨ï¼š

- `saturation_analysis_report.md` - æ·±å…¥çš„æ•°å­¦åˆ†æ
- `summary_report.md` - å®éªŒç»“æœæ€»ç»“
- å„ç§ PNG å›¾ç‰‡ - ç›´è§‚çš„å¯è§†åŒ–åˆ†æ

é€šè¿‡è¿™å¥—å®Œæ•´çš„å‚æ•°ç ”ç©¶å·¥å…·ï¼Œä½ å¯ä»¥ç³»ç»Ÿåœ°åˆ†æ beta å’Œ lambda å¯¹ Energy-DPO çš„å½±å“ï¼Œè¯†åˆ«é¥±å’Œå’Œæ¢¯åº¦å¼±åŒ–ç°è±¡ï¼Œå¹¶æ‰¾åˆ°æœ€ä¼˜çš„å‚æ•°ç»„åˆã€‚